FROM php:7.2-alpine3.7

RUN buildDeps=' \
    bash \
    git \
    g++ \
    make \
    cmake \
    libstdc++ \
    boost-dev \
    boost-system \
    boost-thread \
    curl-dev \
    libressl-dev \
    libc-dev \
    pcre-dev \
    autoconf \
    ' \
    && apk add --update $buildDeps \
    && docker-php-source extract

ENV PHP_CPP_VERSION master

    # PHP-CPP
RUN git clone --branch ${PHP_CPP_VERSION} https://github.com/CopernicaMarketingSoftware/PHP-CPP /tmp/php-cpp \
        && cd /tmp/php-cpp \
        && sed -i 's/`\${PHP_CONFIG} \-\-ldflags`//g' Makefile \
        && make \
        && make install

ENV ARANGODB_PHP_DRIVER master

RUN git clone --branch ${ARANGODB_PHP_DRIVER} https://github.com/sandrokeil/arangodb-php-driver /tmp/arangodb-php-driver \
    && cd /tmp/arangodb-php-driver \
    && sh get_fuerte \
    && cd /tmp/arangodb-php-driver/build && cmake .. -DPHPCPP_ARCH=x86_64 -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS=-fPIC \
    && make install \
    && rm -rf /tmp \
    && echo "extension=libarangodb.so" > /usr/local/etc/php/conf.d/arangodb.ini

RUN apk del --purge $buildDeps

WORKDIR /app

# Set up the application directory
VOLUME ["/app"]
